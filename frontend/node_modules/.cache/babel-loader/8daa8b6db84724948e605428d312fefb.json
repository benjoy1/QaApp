{"ast":null,"code":"'use strict';\n\nvar _errors = require('../errors');\n\nvar _JwksClient = require('../JwksClient');\n\nmodule.exports.koaJwtSecret = function () {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (!options.jwksUri) {\n    throw new _errors.ArgumentError('No JWKS URI provided');\n  }\n\n  var client = new _JwksClient.JwksClient(options);\n  return function secretProvider() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        alg = _ref.alg,\n        kid = _ref.kid;\n\n    return new Promise(function (resolve, reject) {\n      // Only RS256 is supported.\n      if (alg !== 'RS256') {\n        return reject(new Error('Missing / invalid token algorithm'));\n      }\n\n      client.getSigningKey(kid, function (err, key) {\n        if (err) {\n          if (options.handleSigningKeyError) {\n            return options.handleSigningKeyError(err).then(reject);\n          }\n\n          return reject(err);\n        } // Provide the key.\n\n\n        resolve(key.publicKey || key.rsaPublicKey);\n      });\n    });\n  };\n};","map":null,"metadata":{},"sourceType":"script"}